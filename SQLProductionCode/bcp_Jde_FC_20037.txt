bcp " with cte as ( select f.ItemNumber,convert(varchar(6),f.Date,112) as Period_YM,f.Value,'Forecast' as Typ_  from JDE_DB_Alan.JDE_DB_Alan.FCPRO_Fcst f union all select s.ItemNumber,convert(varchar(6),convert(datetime,concat(s.CYM,'01')),112) Period_YM,s.SalesQty,'Sales' as Typ_ from JDE_DB_Alan.JDE_DB_Alan.SlsHist_AWFHDMT_FCPro_upload s  ) ,  comb as ( select cte.ItemNumber,cte.Typ_,cte.Period_YM,cte.Value,m.StandardCost,p.Pareto,m.UOM  from cte left join JDE_DB_Alan.JDE_DB_Alan.Master_ML345 m on cte.ItemNumber = m.ItemNumber  left join JDE_DB_Alan.JDE_DB_Alan.FCPRO_Fcst_Pareto p on cte.Itemnumber = p.ItemNumber  where  m.PrimarySupplier in ('20037')), np as ( select * from JDE_DB_Alan.JDE_DB_Alan.FCPRO_Fcst_NP_upload_tmp ) select comb.ItemNumber,'HD' as BranchPlant,comb.UOM,'BF' as ForcastType ,comb.Period_YM ,convert(date,dateadd(d,-1,dateadd(mm,1,convert(datetime,comb.Period_YM+'01',103))),103) as Period_YMD 	,comb.Value as ForecastQty,0 as ForecastAmt,0 as CustomerNumber,'N' as BypassForcing,comb.Pareto ,np.Range from comb left join np on comb.ItemNumber = np.ItemNumber where  comb.Typ_ in ('Forecast')  and not exists ( select np.ItemNumber from JDE_DB_Alan.JDE_DB_Alan.FCPRO_Fcst_NP_upload_tmp np where np.ItemNumber = comb.ItemNumber) order by Pareto asc,comb.ItemNumber,comb.Period_YM " queryout C:\Users\yaoa\Alan_HD\Alan_Work\coutt.txt -S RYDWS366\SQLEXPRESS -c -T -t,